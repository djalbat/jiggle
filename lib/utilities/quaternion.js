"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.rotateImaginaryQuaternion = rotateImaginaryQuaternion;
exports.calculateInverseRotationQuaternion = calculateInverseRotationQuaternion;
exports.calculateForwardsRotationQuaternion = calculateForwardsRotationQuaternion;
exports.calculateBackwardsRotationQuaternion = calculateBackwardsRotationQuaternion;
exports.calculateArbitraryRotationQuaternion = calculateArbitraryRotationQuaternion;
exports.calculateRotationAboutZAxisQuaternion = calculateRotationAboutZAxisQuaternion;
var _vector = require("../maths/vector");
var _approximate = require("../utilities/approximate");
var _array = require("../utilities/array");
var _angle = require("../utilities/angle");
function rotateImaginaryQuaternion(imaginaryQuaternion, rotationQuaternion, inverseRotationQuaternion) {
    return hamiltonProduct(hamiltonProduct(rotationQuaternion, imaginaryQuaternion), inverseRotationQuaternion);
}
function calculateInverseRotationQuaternion(rotationQuaternion) {
    var rotationQuaternionComponents = rotationQuaternion, firstRotationQuaternionComponent = (0, _array).first(rotationQuaternionComponents), secondRotationQuaternionComponent = (0, _array).second(rotationQuaternionComponents), thirdRotationQuaternionComponent = (0, _array).third(rotationQuaternionComponents), fourthRotationQuaternionComponent = (0, _array).fourth(rotationQuaternionComponents), inverseRotationQuaternion = [
        firstRotationQuaternionComponent,
        -secondRotationQuaternionComponent,
        -thirdRotationQuaternionComponent,
        -fourthRotationQuaternionComponent
    ];
    return inverseRotationQuaternion;
}
function calculateForwardsRotationQuaternion(rotationQuaternion) {
    var forwardsRotationQuaternion = rotationQuaternion; ///
    return forwardsRotationQuaternion;
}
function calculateBackwardsRotationQuaternion(rotationQuaternion) {
    var inverseRotationQuaternion = calculateInverseRotationQuaternion(rotationQuaternion), backwardsRotationQuaternion = inverseRotationQuaternion; ///
    return backwardsRotationQuaternion;
}
function calculateArbitraryRotationQuaternion(normal) {
    var extent = normal.getExtent(), unitNormal = extent, zAxis = [
        0,
        0,
        1
    ], dotProductOfUnitNormalAndZAxis = (0, _vector).dot3(unitNormal, zAxis), crossProductOfUnitNormalAndZAxis = (0, _vector).cross3(unitNormal, zAxis), angleOfRotationCosine = dotProductOfUnitNormalAndZAxis, angleOfRotationCosineAbsoluteValue = Math.abs(angleOfRotationCosine), angleOfRotationCosineAbsoluteValueApproximatelyEqualToOne = (0, _approximate).isApproximatelyEqualToOne(angleOfRotationCosineAbsoluteValue), axisOfRotation = angleOfRotationCosineAbsoluteValueApproximatelyEqualToOne ? [
        1,
        0,
        0
    ] : crossProductOfUnitNormalAndZAxis, unitAxisOfRotation = (0, _vector).normalise3(axisOfRotation), halfAngleOfRotationCosine = (0, _angle).calculateHalfAngleCosine(angleOfRotationCosine), halfAngleOfRotationSine = (0, _angle).calculateHalfAngleSine(angleOfRotationCosine), unitAxisOfRotationComponents = unitAxisOfRotation, firstAxisOfRotationComponent = (0, _array).first(unitAxisOfRotationComponents), secondAxisOfRotationComponent = (0, _array).second(unitAxisOfRotationComponents), thirdAxisOfRotationComponent = (0, _array).third(unitAxisOfRotationComponents), arbitraryRotationQuaternion = [
        halfAngleOfRotationCosine,
        firstAxisOfRotationComponent * halfAngleOfRotationSine,
        secondAxisOfRotationComponent * halfAngleOfRotationSine,
        thirdAxisOfRotationComponent * halfAngleOfRotationSine
    ];
    return arbitraryRotationQuaternion;
}
function calculateRotationAboutZAxisQuaternion(maskingEdge) {
    var maskingEdgeExtent = maskingEdge.getExtent(), unitMaskingEdgeExtent = (0, _vector).normalise3(maskingEdgeExtent), unitMaskingEdgeExtentComponents = unitMaskingEdgeExtent, firstUnitMaskingEdgeExtentComponent = (0, _array).first(unitMaskingEdgeExtentComponents), secondUnitMaskingEdgeExtentComponent = (0, _array).second(unitMaskingEdgeExtentComponents), angleOfRotationSine = firstUnitMaskingEdgeExtentComponent, angleOfRotationCosine = secondUnitMaskingEdgeExtentComponent, halfAngleOfRotationCosine = (0, _angle).calculateHalfAngleCosine(angleOfRotationCosine), halfAngleOfRotationSine = angleOfRotationSine > 0 ? +(0, _angle).calculateHalfAngleSine(angleOfRotationCosine) : -(0, _angle).calculateHalfAngleSine(angleOfRotationCosine), rotationAboutZAxisQuaternion = [
        halfAngleOfRotationCosine,
        0,
        0,
        halfAngleOfRotationSine
    ];
    return rotationAboutZAxisQuaternion;
}
function hamiltonProduct(quaternionA, quaternionB) {
    var a1 = quaternionA[0], b1 = quaternionA[1], c1 = quaternionA[2], d1 = quaternionA[3], a2 = quaternionB[0], b2 = quaternionB[1], c2 = quaternionB[2], d2 = quaternionB[3], a = a1 * a2 - b1 * b2 - c1 * c2 - d1 * d2, b = a1 * b2 + b1 * a2 + c1 * d2 - d1 * c2, c = a1 * c2 - b1 * d2 + c1 * a2 + d1 * b2, d = a1 * d2 + b1 * c2 - c1 * b2 + d1 * a2, quaternion = [
        a,
        b,
        c,
        d
    ];
    return quaternion;
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsaXRpZXMvcXVhdGVybmlvbi5qcyJdLCJuYW1lcyI6WyJkb3QzIiwiY3Jvc3MzIiwibm9ybWFsaXNlMyIsImlzQXBwcm94aW1hdGVseUVxdWFsVG9PbmUiLCJmaXJzdCIsInNlY29uZCIsInRoaXJkIiwiZm91cnRoIiwiY2FsY3VsYXRlSGFsZkFuZ2xlQ29zaW5lIiwiY2FsY3VsYXRlSGFsZkFuZ2xlU2luZSIsInJvdGF0ZUltYWdpbmFyeVF1YXRlcm5pb24iLCJpbWFnaW5hcnlRdWF0ZXJuaW9uIiwicm90YXRpb25RdWF0ZXJuaW9uIiwiaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbiIsImhhbWlsdG9uUHJvZHVjdCIsImNhbGN1bGF0ZUludmVyc2VSb3RhdGlvblF1YXRlcm5pb24iLCJyb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnRzIiwiZmlyc3RSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQiLCJzZWNvbmRSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQiLCJ0aGlyZFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCIsImZvdXJ0aFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCIsImNhbGN1bGF0ZUZvcndhcmRzUm90YXRpb25RdWF0ZXJuaW9uIiwiZm9yd2FyZHNSb3RhdGlvblF1YXRlcm5pb24iLCJjYWxjdWxhdGVCYWNrd2FyZHNSb3RhdGlvblF1YXRlcm5pb24iLCJiYWNrd2FyZHNSb3RhdGlvblF1YXRlcm5pb24iLCJjYWxjdWxhdGVBcmJpdHJhcnlSb3RhdGlvblF1YXRlcm5pb24iLCJub3JtYWwiLCJleHRlbnQiLCJnZXRFeHRlbnQiLCJ1bml0Tm9ybWFsIiwiekF4aXMiLCJkb3RQcm9kdWN0T2ZVbml0Tm9ybWFsQW5kWkF4aXMiLCJjcm9zc1Byb2R1Y3RPZlVuaXROb3JtYWxBbmRaQXhpcyIsImFuZ2xlT2ZSb3RhdGlvbkNvc2luZSIsImFuZ2xlT2ZSb3RhdGlvbkNvc2luZUFic29sdXRlVmFsdWUiLCJNYXRoIiwiYWJzIiwiYW5nbGVPZlJvdGF0aW9uQ29zaW5lQWJzb2x1dGVWYWx1ZUFwcHJveGltYXRlbHlFcXVhbFRvT25lIiwiYXhpc09mUm90YXRpb24iLCJ1bml0QXhpc09mUm90YXRpb24iLCJoYWxmQW5nbGVPZlJvdGF0aW9uQ29zaW5lIiwiaGFsZkFuZ2xlT2ZSb3RhdGlvblNpbmUiLCJ1bml0QXhpc09mUm90YXRpb25Db21wb25lbnRzIiwiZmlyc3RBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCIsInNlY29uZEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50IiwidGhpcmRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCIsImFyYml0cmFyeVJvdGF0aW9uUXVhdGVybmlvbiIsImNhbGN1bGF0ZVJvdGF0aW9uQWJvdXRaQXhpc1F1YXRlcm5pb24iLCJtYXNraW5nRWRnZSIsIm1hc2tpbmdFZGdlRXh0ZW50IiwidW5pdE1hc2tpbmdFZGdlRXh0ZW50IiwidW5pdE1hc2tpbmdFZGdlRXh0ZW50Q29tcG9uZW50cyIsImZpcnN0VW5pdE1hc2tpbmdFZGdlRXh0ZW50Q29tcG9uZW50Iiwic2Vjb25kVW5pdE1hc2tpbmdFZGdlRXh0ZW50Q29tcG9uZW50IiwiYW5nbGVPZlJvdGF0aW9uU2luZSIsInJvdGF0aW9uQWJvdXRaQXhpc1F1YXRlcm5pb24iLCJxdWF0ZXJuaW9uQSIsInF1YXRlcm5pb25CIiwiYTEiLCJiMSIsImMxIiwiZDEiLCJhMiIsImIyIiwiYzIiLCJkMiIsImEiLCJiIiwiYyIsImQiLCJxdWF0ZXJuaW9uIl0sIm1hcHBpbmdzIjoiQ0FBQSxVQUFZOzs7O1FBT0kseUJBQXlCLEdBQXpCLHlCQUF5QjtRQUV6QixrQ0FBa0MsR0FBbEMsa0NBQWtDO1FBZ0JsQyxtQ0FBbUMsR0FBbkMsbUNBQW1DO1FBTW5DLG9DQUFvQyxHQUFwQyxvQ0FBb0M7UUFRcEMsb0NBQW9DLEdBQXBDLG9DQUFvQztRQTZCcEMscUNBQXFDLEdBQXJDLHFDQUFxQztBQWxFWixHQUFpQixDQUFqQixPQUFpQjtBQUNoQixHQUEwQixDQUExQixZ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QUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFDekMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQ3pDLFVBQVUsR0FBRyxDQUFDO1FBQUMsQ0FBQztRQUFFLENBQUM7UUFBRSxDQUFDO1FBQUUsQ0FBQztJQUFDLENBQUM7SUFFakMsTUFBTSxDQUFDLFVBQVU7QUFDbkIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgeyBkb3QzLCBjcm9zczMsIG5vcm1hbGlzZTMgfSBmcm9tIFwiLi4vbWF0aHMvdmVjdG9yXCI7XG5pbXBvcnQgeyBpc0FwcHJveGltYXRlbHlFcXVhbFRvT25lIH0gZnJvbSBcIi4uL3V0aWxpdGllcy9hcHByb3hpbWF0ZVwiO1xuaW1wb3J0IHsgZmlyc3QsIHNlY29uZCwgdGhpcmQsIGZvdXJ0aCB9IGZyb20gXCIuLi91dGlsaXRpZXMvYXJyYXlcIjtcbmltcG9ydCB7IGNhbGN1bGF0ZUhhbGZBbmdsZUNvc2luZSwgY2FsY3VsYXRlSGFsZkFuZ2xlU2luZSB9IGZyb20gXCIuLi91dGlsaXRpZXMvYW5nbGVcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIHJvdGF0ZUltYWdpbmFyeVF1YXRlcm5pb24oaW1hZ2luYXJ5UXVhdGVybmlvbiwgcm90YXRpb25RdWF0ZXJuaW9uLCBpbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uKSB7IHJldHVybiBoYW1pbHRvblByb2R1Y3QoaGFtaWx0b25Qcm9kdWN0KHJvdGF0aW9uUXVhdGVybmlvbiwgaW1hZ2luYXJ5UXVhdGVybmlvbiksIGludmVyc2VSb3RhdGlvblF1YXRlcm5pb24pOyB9XG5cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVJbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uKHJvdGF0aW9uUXVhdGVybmlvbikge1xuICBjb25zdCByb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnRzID0gcm90YXRpb25RdWF0ZXJuaW9uLCAgLy8vXG4gICAgICAgIGZpcnN0Um90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50ID0gZmlyc3Qocm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50cyksXG4gICAgICAgIHNlY29uZFJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudCA9IHNlY29uZChyb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnRzKSxcbiAgICAgICAgdGhpcmRSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQgPSB0aGlyZChyb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnRzKSxcbiAgICAgICAgZm91cnRoUm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50ID0gZm91cnRoKHJvdGF0aW9uUXVhdGVybmlvbkNvbXBvbmVudHMpLFxuICAgICAgICBpbnZlcnNlUm90YXRpb25RdWF0ZXJuaW9uID0gW1xuICAgICAgICAgIGZpcnN0Um90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50LFxuICAgICAgICAgIC1zZWNvbmRSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnQsXG4gICAgICAgICAgLXRoaXJkUm90YXRpb25RdWF0ZXJuaW9uQ29tcG9uZW50LFxuICAgICAgICAgIC1mb3VydGhSb3RhdGlvblF1YXRlcm5pb25Db21wb25lbnRcbiAgICAgICAgXTtcblxuICByZXR1cm4gaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUZvcndhcmRzUm90YXRpb25RdWF0ZXJuaW9uKHJvdGF0aW9uUXVhdGVybmlvbikge1xuICBjb25zdCBmb3J3YXJkc1JvdGF0aW9uUXVhdGVybmlvbiA9IHJvdGF0aW9uUXVhdGVybmlvbjsgIC8vL1xuXG4gIHJldHVybiBmb3J3YXJkc1JvdGF0aW9uUXVhdGVybmlvbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUJhY2t3YXJkc1JvdGF0aW9uUXVhdGVybmlvbihyb3RhdGlvblF1YXRlcm5pb24pIHtcbiAgY29uc3QgaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbiA9IGNhbGN1bGF0ZUludmVyc2VSb3RhdGlvblF1YXRlcm5pb24ocm90YXRpb25RdWF0ZXJuaW9uKSxcbiAgICAgICAgYmFja3dhcmRzUm90YXRpb25RdWF0ZXJuaW9uID0gaW52ZXJzZVJvdGF0aW9uUXVhdGVybmlvbjsgIC8vL1xuXG4gIHJldHVybiBiYWNrd2FyZHNSb3RhdGlvblF1YXRlcm5pb247XG5cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUFyYml0cmFyeVJvdGF0aW9uUXVhdGVybmlvbihub3JtYWwpIHtcbiAgY29uc3QgZXh0ZW50ID0gbm9ybWFsLmdldEV4dGVudCgpLFxuICAgICAgICB1bml0Tm9ybWFsID0gZXh0ZW50LCAgLy8vXG4gICAgICAgIHpBeGlzID0gWyAwLCAwLCAxIF0sXG4gICAgICAgIGRvdFByb2R1Y3RPZlVuaXROb3JtYWxBbmRaQXhpcyA9IGRvdDModW5pdE5vcm1hbCwgekF4aXMpLFxuICAgICAgICBjcm9zc1Byb2R1Y3RPZlVuaXROb3JtYWxBbmRaQXhpcyA9IGNyb3NzMyh1bml0Tm9ybWFsLCB6QXhpcyksXG4gICAgICAgIGFuZ2xlT2ZSb3RhdGlvbkNvc2luZSA9IGRvdFByb2R1Y3RPZlVuaXROb3JtYWxBbmRaQXhpcywgLy8vXG4gICAgICAgIGFuZ2xlT2ZSb3RhdGlvbkNvc2luZUFic29sdXRlVmFsdWUgPSBNYXRoLmFicyhhbmdsZU9mUm90YXRpb25Db3NpbmUpLFxuICAgICAgICBhbmdsZU9mUm90YXRpb25Db3NpbmVBYnNvbHV0ZVZhbHVlQXBwcm94aW1hdGVseUVxdWFsVG9PbmUgPSBpc0FwcHJveGltYXRlbHlFcXVhbFRvT25lKGFuZ2xlT2ZSb3RhdGlvbkNvc2luZUFic29sdXRlVmFsdWUpLFxuICAgICAgICBheGlzT2ZSb3RhdGlvbiA9IGFuZ2xlT2ZSb3RhdGlvbkNvc2luZUFic29sdXRlVmFsdWVBcHByb3hpbWF0ZWx5RXF1YWxUb09uZSA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgIFsgMSwgMCwgMCBdIDogLy8vXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3Jvc3NQcm9kdWN0T2ZVbml0Tm9ybWFsQW5kWkF4aXMsXG4gICAgICAgIHVuaXRBeGlzT2ZSb3RhdGlvbiA9IG5vcm1hbGlzZTMoYXhpc09mUm90YXRpb24pLFxuICAgICAgICBoYWxmQW5nbGVPZlJvdGF0aW9uQ29zaW5lID0gY2FsY3VsYXRlSGFsZkFuZ2xlQ29zaW5lKGFuZ2xlT2ZSb3RhdGlvbkNvc2luZSksXG4gICAgICAgIGhhbGZBbmdsZU9mUm90YXRpb25TaW5lID0gY2FsY3VsYXRlSGFsZkFuZ2xlU2luZShhbmdsZU9mUm90YXRpb25Db3NpbmUpLFxuICAgICAgICB1bml0QXhpc09mUm90YXRpb25Db21wb25lbnRzID0gdW5pdEF4aXNPZlJvdGF0aW9uLCAgLy8vXG4gICAgICAgIGZpcnN0QXhpc09mUm90YXRpb25Db21wb25lbnQgPSBmaXJzdCh1bml0QXhpc09mUm90YXRpb25Db21wb25lbnRzKSxcbiAgICAgICAgc2Vjb25kQXhpc09mUm90YXRpb25Db21wb25lbnQgPSBzZWNvbmQodW5pdEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50cyksXG4gICAgICAgIHRoaXJkQXhpc09mUm90YXRpb25Db21wb25lbnQgPSB0aGlyZCh1bml0QXhpc09mUm90YXRpb25Db21wb25lbnRzKSxcbiAgICAgICAgYXJiaXRyYXJ5Um90YXRpb25RdWF0ZXJuaW9uID0gW1xuICAgICAgICAgIGhhbGZBbmdsZU9mUm90YXRpb25Db3NpbmUsXG4gICAgICAgICAgZmlyc3RBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCAqIGhhbGZBbmdsZU9mUm90YXRpb25TaW5lLFxuICAgICAgICAgIHNlY29uZEF4aXNPZlJvdGF0aW9uQ29tcG9uZW50ICogaGFsZkFuZ2xlT2ZSb3RhdGlvblNpbmUsXG4gICAgICAgICAgdGhpcmRBeGlzT2ZSb3RhdGlvbkNvbXBvbmVudCAqIGhhbGZBbmdsZU9mUm90YXRpb25TaW5lXG4gICAgICAgIF07XG5cbiAgcmV0dXJuIGFyYml0cmFyeVJvdGF0aW9uUXVhdGVybmlvbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZVJvdGF0aW9uQWJvdXRaQXhpc1F1YXRlcm5pb24obWFza2luZ0VkZ2UpIHtcbiAgY29uc3QgbWFza2luZ0VkZ2VFeHRlbnQgPSBtYXNraW5nRWRnZS5nZXRFeHRlbnQoKSxcbiAgICAgICAgdW5pdE1hc2tpbmdFZGdlRXh0ZW50ID0gbm9ybWFsaXNlMyhtYXNraW5nRWRnZUV4dGVudCksXG4gICAgICAgIHVuaXRNYXNraW5nRWRnZUV4dGVudENvbXBvbmVudHMgPSB1bml0TWFza2luZ0VkZ2VFeHRlbnQsICAvLy9cbiAgICAgICAgZmlyc3RVbml0TWFza2luZ0VkZ2VFeHRlbnRDb21wb25lbnQgPSBmaXJzdCh1bml0TWFza2luZ0VkZ2VFeHRlbnRDb21wb25lbnRzKSxcbiAgICAgICAgc2Vjb25kVW5pdE1hc2tpbmdFZGdlRXh0ZW50Q29tcG9uZW50ID0gc2Vjb25kKHVuaXRNYXNraW5nRWRnZUV4dGVudENvbXBvbmVudHMpLFxuICAgICAgICBhbmdsZU9mUm90YXRpb25TaW5lID0gZmlyc3RVbml0TWFza2luZ0VkZ2VFeHRlbnRDb21wb25lbnQsICAvLy9cbiAgICAgICAgYW5nbGVPZlJvdGF0aW9uQ29zaW5lID0gc2Vjb25kVW5pdE1hc2tpbmdFZGdlRXh0ZW50Q29tcG9uZW50LCAgLy8vXG4gICAgICAgIGhhbGZBbmdsZU9mUm90YXRpb25Db3NpbmUgPSBjYWxjdWxhdGVIYWxmQW5nbGVDb3NpbmUoYW5nbGVPZlJvdGF0aW9uQ29zaW5lKSxcbiAgICAgICAgaGFsZkFuZ2xlT2ZSb3RhdGlvblNpbmUgPSAoYW5nbGVPZlJvdGF0aW9uU2luZSA+IDAgKSA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICtjYWxjdWxhdGVIYWxmQW5nbGVTaW5lKGFuZ2xlT2ZSb3RhdGlvbkNvc2luZSkgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC1jYWxjdWxhdGVIYWxmQW5nbGVTaW5lKGFuZ2xlT2ZSb3RhdGlvbkNvc2luZSksXG4gICAgICAgIHJvdGF0aW9uQWJvdXRaQXhpc1F1YXRlcm5pb24gPSBbXG4gICAgICAgICAgaGFsZkFuZ2xlT2ZSb3RhdGlvbkNvc2luZSxcbiAgICAgICAgICAwLFxuICAgICAgICAgIDAsXG4gICAgICAgICAgaGFsZkFuZ2xlT2ZSb3RhdGlvblNpbmVcbiAgICAgICAgXTtcblxuICByZXR1cm4gcm90YXRpb25BYm91dFpBeGlzUXVhdGVybmlvbjtcbn1cblxuZnVuY3Rpb24gaGFtaWx0b25Qcm9kdWN0KHF1YXRlcm5pb25BLCBxdWF0ZXJuaW9uQikge1xuICBjb25zdCBhMSA9IHF1YXRlcm5pb25BWzBdLFxuICAgICAgICBiMSA9IHF1YXRlcm5pb25BWzFdLFxuICAgICAgICBjMSA9IHF1YXRlcm5pb25BWzJdLFxuICAgICAgICBkMSA9IHF1YXRlcm5pb25BWzNdLFxuICAgICAgICBhMiA9IHF1YXRlcm5pb25CWzBdLFxuICAgICAgICBiMiA9IHF1YXRlcm5pb25CWzFdLFxuICAgICAgICBjMiA9IHF1YXRlcm5pb25CWzJdLFxuICAgICAgICBkMiA9IHF1YXRlcm5pb25CWzNdLFxuICAgICAgICBhID0gYTEgKiBhMiAtIGIxICogYjIgLSBjMSAqIGMyIC0gZDEgKiBkMixcbiAgICAgICAgYiA9IGExICogYjIgKyBiMSAqIGEyICsgYzEgKiBkMiAtIGQxICogYzIsXG4gICAgICAgIGMgPSBhMSAqIGMyIC0gYjEgKiBkMiArIGMxICogYTIgKyBkMSAqIGIyLFxuICAgICAgICBkID0gYTEgKiBkMiArIGIxICogYzIgLSBjMSAqIGIyICsgZDEgKiBhMixcbiAgICAgICAgcXVhdGVybmlvbiA9IFsgYSwgYiwgYywgZCBdO1xuXG4gIHJldHVybiBxdWF0ZXJuaW9uO1xufVxuIl19